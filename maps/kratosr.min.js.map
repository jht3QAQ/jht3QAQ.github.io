{"version":3,"sources":["kratosr.js"],"names":["_typeof","o","Symbol","iterator","constructor","prototype","_regeneratorRuntime","e","t","r","Object","n","hasOwnProperty","defineProperty","value","i","a","c","asyncIterator","u","toStringTag","define","enumerable","configurable","writable","wrap","Generator","create","Context","makeInvokeMethod","tryCatch","type","arg","call","h","l","f","s","y","GeneratorFunction","GeneratorFunctionPrototype","p","this","d","getPrototypeOf","v","values","g","defineIteratorMethods","forEach","_invoke","AsyncIterator","invoke","resolve","__await","then","callInvokeWithMethodAndArg","Error","done","method","delegate","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","return","TypeError","resultName","next","nextLoc","pushTryEntry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","isNaN","length","displayName","isGeneratorFunction","name","mark","setPrototypeOf","__proto__","awrap","async","Promise","keys","reverse","pop","prev","charAt","slice","stop","rval","handle","complete","finish","catch","delegateYield","asyncGeneratorStep","gen","reject","_next","_throw","key","info","error","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","window","requestIdleCallback","handler","startTime","Date","now","setTimeout","didTimeout","timeRemaining","Math","max","cancelIdleCallback","id","clearTimeout","copyCode","triggerBtn","targetCodeID","targetCodeElement","document","getElementById","code","innerText","navigator","clipboard","writeText","origInner","innerHTML","copyrightString","loadConfig","_ref","_callee","_window$kr","url","_context","kr","siteRoot","fetch","json","docTitle","getTimeString","msec","tString","exact","sec","dnum","floor","hnum","mnum","snum","dstr","toString","hstr","mstr","sstr","makeDelay","callback","ms","timer","context","initPerPage","sidebarTocWidget","initFunc","tocDOMs","getElementsByClassName","tocItems","Array","from","tocItem","linkItem","querySelector","titleText","decodeURI","getAttribute","substring","titleElem","setAttribute","at","el","console","log","message","classList","add","curTocId","tocActivate","newId","remove","nCur","contains","parentNode","applyDecision","pos","scrollY","requestAnimationFrame","observer","IntersectionObserver","entries","decision","entry","currentIndex","Number","parseInt","target","isIntersecting","boundingClientRect","top","rootBounds","bottom","height","intersectionRatio","rootMargin","threshold","x","observe","addEventListener","disconnect","once","tocUpdatePos","getBoundingClientRect","tocGetId","newPos","isInteger","nowY","tocOnScroll","tocOnResize","removeEventListener","readProgBar","articleElem","setPercent","currentTop","documentElement","scrollTop","docHeight","clientHeight","winHeight","headerHeight","offsetTop","contentMath","scrollHeight","scrollPercent","min","scrollPercentRound","round","style","width","offsetParent","title","querySelectorAll","figure","count","getElementsByTagName","concat","$","fancybox","defaults","hash","each","find","parent","hasClass","is","alt","after","src","runningOnBrowser","isBot","test","userAgent","supportsIntersectionObserver","commsArea","loadwork","loadCommentsEventHandler","load_comm","commentsLazyLoad","initPerPageWithConfig","imageboxs","randomAmount","cover","baseUrl","coverFileNameTemplate","filenameTemplate","usedCovers","generateNewCoverID","coverNo","remailFailCounts","random","len","attr","coverFileName","replace","coverUrl","includes","loadRandomCover","copyrightNotice","location","href","setCopyright","expire_day","expireAlert","dateTimeTag","updateDateTime","gap","expireNotify","themeInit","isScrolledDown","pageScrollDownClass","$clone","body","oncopy","copiedContent","getSelection","preventDefault","clipboardData","setData","copyEventInit","siteLeaveEvent","titleTime","OriginLogo","hidden","leaveTitle","leaveLogo","returnTitle","leaveEventInit","createTime","upTimeNode","setInterval","initTime","on","layer","open","area","donateBtn","resize","scrollbar","content","scanNotice","qr_alipay","qr_wechat","click","removeClass","addClass","donateConfig","topNavScrollToggle","lastHeight","innerHeight","isTopNavHidden","topNavScrollToggleInit","event","animate","offset","clone","prepend","css","w","container","has","slideToggle","fadeToggle","MathJax","Hub","Typeset","readyState"],"mappings":"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","file":"../js/kratosr.min.js","sourcesContent":["/**\r\n * 因为后台任务API还是相当新的，而你的代码可能需要在那些仍不支持此API的浏览器上运行。\r\n * 你可以把 setTimeout() 用作回调选项来做这样的事。\r\n * 这个并不是 polyfill ，因为它在功能上并不相同； \r\n * setTimeout() 并不会让你利用空闲时段，而是使你的代码在情况允许时执行你的代码，\r\n * 以使我们可以尽可能地避免造成用户体验性能表现延迟的后果。\r\n */\r\n// https://developer.mozilla.org/zh-CN/docs/Web/API/Background_Tasks_API \r\nwindow.requestIdleCallback = window.requestIdleCallback || function(handler) {\r\n    let startTime = Date.now();\r\n    return setTimeout(function() {\r\n      handler({\r\n        didTimeout: false,\r\n        timeRemaining: function() {\r\n          return Math.max(0, 50.0 - (Date.now() - startTime));\r\n        }\r\n      });\r\n    }, 1);\r\n};\r\n\r\nwindow.cancelIdleCallback = window.cancelIdleCallback || function(id) {\r\n    clearTimeout(id);\r\n};\r\n\r\n/**\r\n * 一些暴露给 DOM 交互使用的全局函数\r\n */\r\n\r\nwindow.copyCode = window.copyCode || function(triggerBtn, targetCodeID) {\r\n    // 用了 navigator.clipboard API ，不要再用老依赖和写法了\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/Navigator/clipboard\r\n    const targetCodeElement = document.getElementById(targetCodeID);\r\n    if (targetCodeElement) {\r\n        const code = targetCodeElement.innerText;\r\n        navigator.clipboard.writeText(code);\r\n\r\n        // 复制成功，庆祝一下\r\n        const origInner = triggerBtn.innerHTML;\r\n        triggerBtn.innerHTML = `<i class=\"fa fa-check-circle\"></i>&nbsp;成功~`;\r\n        setTimeout(() => {\r\n            triggerBtn.innerHTML = origInner;\r\n        }, 3000);\r\n    }\r\n    // 并且这样复制不会触发 CC 提示，就不用担心代码被提示弄出一堆错了\r\n};\r\n\r\n/**\r\n * 核心的配置体，包一层防止全局变量命名导致的冲突\r\n */\r\n\r\n(()=>{\r\n    const loadConfig = async () => {\r\n        var url = (window.kr?.siteRoot || '/') + 'config/main.json';\r\n        return await (await fetch(url)).json()\r\n    };\r\n    const pageScrollDownInit = ()=>{\r\n        let isScrolledDown = false;\r\n        const pageScrollDownClass = () => {\r\n            window.requestAnimationFrame(() => {\r\n                if (window.scrollY > 200){\r\n                    if (!isScrolledDown) {\r\n                        document.body.classList.add('scroll-down');\r\n                        isScrolledDown = true;\r\n                    }\r\n                } else {\r\n                    if (isScrolledDown) {\r\n                        document.body.classList.remove('scroll-down');\r\n                        isScrolledDown = false;\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        $('.gotop-box').on('click',function(event){\r\n            // event.preventDefault();\r\n            $('html, body').animate({\r\n                scrollTop:$('html').offset().top\r\n            },500);\r\n            return false;\r\n        });\r\n        pageScrollDownClass();\r\n        window.addEventListener('scroll', pageScrollDownClass);\r\n    };\r\n    const offcanvas = ()=>{\r\n        let $clone = $('#kratos-menu-wrap').clone();\r\n        $clone.attr({\r\n            'id':'offcanvas-menu'\r\n        });\r\n        $clone.find('> ul').attr({\r\n            'id':''\r\n        }).addClass('ul-me');\r\n        $('#kratos-page').prepend($clone);\r\n        $('.js-kratos-nav-toggle').on('click',()=>{\r\n            if($('.nav-toggle').hasClass('toon')){\r\n                $('.nav-toggle').removeClass('toon');\r\n                $('#offcanvas-menu').css('right','-240px');\r\n            }else{\r\n                $('.nav-toggle').addClass('toon');\r\n                $('#offcanvas-menu').css('right','0px');\r\n            }\r\n        });\r\n        $('#offcanvas-menu').css('height',$(window).height());\r\n        $('#offcanvas-menu').css('right','-240px');\r\n        $(window).resize(()=>{\r\n            const w = $(window);\r\n            $('#offcanvas-menu').css('height',w.height());\r\n            if(w.width()>769){\r\n                if($('.nav-toggle').hasClass('toon')){\r\n                    $('.nav-toggle').removeClass('toon');\r\n                    $('#offcanvas-menu').css('right','-240px');\r\n                }\r\n            }\r\n        });\r\n    };\r\n    const mobiClick = ()=>{\r\n        $(document).click((e)=>{\r\n            const container = $(\"#offcanvas-menu,.js-kratos-nav-toggle\");\r\n            if (!container.is(e.target) && container.has(e.target).length === 0) {\r\n                if ($('.nav-toggle').hasClass('toon')) {\r\n                    $('.nav-toggle').removeClass('toon');\r\n                    $('#offcanvas-menu').css('right','-240px');\r\n                }\r\n            }\r\n        });\r\n    };\r\n    const xControl = ()=>{\r\n        $(document).on(\"click\",\".xHeading\", function(event){\r\n            $(this).next().slideToggle(300);\r\n            if ($(this).parent('.xControl').hasClass('active')) {\r\n                $(this).parent('.xControl').removeClass('active');\r\n            } else {\r\n                $(this).parent('.xControl').addClass('active');\r\n            }\r\n            event.preventDefault();\r\n        });\r\n    };\r\n\r\n    const donateConfig = (kr)=>{\r\n        $(document).on(\"click\",\".donate\",()=>{\r\n            layer.open({\r\n                type:1,\r\n                area:['300px', '370px'],\r\n                title:kr.donateBtn,\r\n                resize:false,\r\n                scrollbar:false,\r\n                content:'<div class=\"donate-box\"><div class=\"meta-pay text-center\"><strong>'+kr.scanNotice+'</strong></div><div class=\"qr-pay text-center\"><img class=\"pay-img\" id=\"alipay_qr\" src=\"'+kr.qr_alipay+'\"><img class=\"pay-img d-none\" id=\"wechat_qr\" src=\"'+kr.qr_wechat+'\"></div><div class=\"choose-pay text-center mt-2\"><input id=\"alipay\" type=\"radio\" name=\"pay-method\" checked><label for=\"alipay\" class=\"pay-button\"><img src=\"/images/alipay.webp\"></label><input id=\"wechatpay\" type=\"radio\" name=\"pay-method\"><label for=\"wechatpay\" class=\"pay-button\"><img src=\"/images/wechat.webp\"></label></div></div>'\r\n            });\r\n            $(\".choose-pay input[type='radio']\").click(function(){\r\n                const id = $(this).attr(\"id\");\r\n                if (id == 'alipay') {\r\n                    $(\".qr-pay #alipay_qr\").removeClass('d-none');\r\n                    $(\".qr-pay #wechat_qr\").addClass('d-none');\r\n                }\r\n                if (id == 'wechatpay') {\r\n                    $(\".qr-pay #alipay_qr\").addClass('d-none');\r\n                    $(\".qr-pay #wechat_qr\").removeClass('d-none');\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    const shareMenu = ()=>{\r\n        $(document).on(\"click\",\".share\",()=>{$(\".share-wrap\").fadeToggle(\"slow\");});\r\n    };\r\n\r\n    const loadRandomCover = (kr)=>{\r\n        // 图片\r\n        const imageboxs = document.getElementsByClassName(\"kratos-entry-thumb-new-img\");\r\n        const randomAmount = kr.cover && kr.cover.randomAmount || 20;\r\n        const baseUrl = kr.cover && kr.cover.baseUrl || 'https://cdn.jsdelivr.net/npm/hexo-theme-kratos-rebirth@latest/source/images/thumb/'\r\n        const coverFileNameTemplate = kr.cover && kr.cover.filenameTemplate || \"thumb_{no}.webp\";\r\n        const usedCovers = new Array(randomAmount + 1);\r\n\r\n        const generateNewCoverID = () => {\r\n            let remailFailCounts = 5; // set max fail counts\r\n            let coverNo;\r\n            while (remailFailCounts > 0) {\r\n                // rand one\r\n                coverNo = Math.floor(Math.random() * randomAmount + 1);\r\n                if (!usedCovers[coverNo]) {\r\n                    // valid\r\n                    break;\r\n                } else {\r\n                    // fails\r\n                    remailFailCounts--;\r\n                }\r\n            }\r\n\r\n            if (remailFailCounts <= 0) {\r\n                // rand failed, find one manually\r\n                coverNo = -1;\r\n                for (let i = 1; i <= randomAmount; i++) {\r\n                    if (!usedCovers[i]) {\r\n                        // use first\r\n                        coverNo = i;\r\n                        break;\r\n                    }\r\n                }\r\n                if (coverNo === -1) {\r\n                    // All used\r\n                    // clear all\r\n                    for (let i = 1; i <= randomAmount; i++) {\r\n                        usedCovers[i] = false;\r\n                    }\r\n                    // rand one\r\n                    coverNo = Math.floor(Math.random() * randomAmount + 1);\r\n                }\r\n            }\r\n\r\n            // mark as used\r\n            usedCovers[coverNo] = true;\r\n            \r\n            // return\r\n            return coverNo;\r\n        }\r\n\r\n        for (let i = 0, len = imageboxs.length; i < len; i++) {\r\n            if (!($(imageboxs[i]).attr(\"src\"))) {\r\n                const coverNo = generateNewCoverID();\r\n                const coverFileName = coverFileNameTemplate.replace(\"{no}\", coverNo.toString());\r\n                let coverUrl;\r\n                if (coverFileName.includes(\"//\")) {\r\n                    coverUrl = coverFileName;\r\n                } else if (baseUrl.substring(baseUrl.length - 1) === \"/\") {\r\n                    coverUrl = baseUrl + coverFileName;\r\n                } else {\r\n                    coverUrl = baseUrl + '/' + coverFileName;\r\n                }\r\n                $(imageboxs[i]).attr(\"src\", coverUrl);\r\n            }\r\n        }\r\n    };\r\n\r\n    const fancyboxInit = ()=>{\r\n          if (typeof $.fancybox !== 'undefined'){\r\n            $.fancybox.defaults.hash = false;\r\n            $('.kratos-hentry').each(function(i){\r\n                $(this).find('img').each(function(){\r\n                  if ($(this).parent().hasClass('fancybox') || $(this).parent().hasClass('qrcode') || $(this).parent().is('a')) return;\r\n                  const alt = this.alt;\r\n                  if (alt) $(this).after('<span class=\"caption\">' + alt + '</span>');\r\n                  $(this).wrap('<a rel=\"gallery\" href=\"' + this.src + '\" data-fancybox=\\\"gallery\\\" data-caption=\"' + alt + '\"></a>')\r\n                });\r\n            });\r\n            $('.fancybox').fancybox();\r\n          }\r\n    };\r\n\r\n    const tocNavInit = ()=>{\r\n        $(document).on(\"click\", 'a[class=toc-link]', function(){\r\n            $('html, body').animate({\r\n                scrollTop:$(decodeURI($(this).attr(\"href\"))).offset().top - 60\r\n            },500);\r\n            return false;\r\n        });\r\n    };\r\n\r\n    let copyrightString;\r\n    const setCopyright = (kr)=>{\r\n        copyrightString = `\r\n\r\n-------------------------\r\n${kr.copyrightNotice}\r\n作者：${document.querySelector(\"meta[name='author']\").getAttribute('content')}\r\n来源：${document.title}\r\n链接：${window.location.href}\r\n`;\r\n    }\r\n\r\n    const copyEventInit = (kr)=>{\r\n        if (kr.copyrightNotice) {\r\n            document.body.oncopy = (e)=>{\r\n                if (copyrightString) {\r\n                    const copiedContent = window.getSelection().toString();\r\n                    if (copiedContent.length > 150) {\r\n                        e.preventDefault();\r\n                        if (e.clipboardData) {\r\n                            e.clipboardData.setData(\"text/plain\", copiedContent + copyrightString);\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    };\r\n\r\n    let docTitle = '';\r\n    const saveTitle = () => {\r\n        docTitle = document.title;\r\n    };\r\n\r\n    const leaveEventInit = (kr) => {\r\n        if (kr.siteLeaveEvent) {\r\n            let titleTime;\r\n            const OriginLogo = $('[rel=\"icon\"]').attr(\"href\");\r\n            document.addEventListener('visibilitychange', ()=>{\r\n                if (document.hidden) {\r\n                    document.title = kr.leaveTitle;\r\n                    if (kr.leaveLogo) {\r\n                        $('[rel=\"icon\"]').attr(\"href\", kr.leaveLogo);\r\n                    }\r\n                    clearTimeout(titleTime);\r\n                } else {\r\n                    document.title = kr.returnTitle + \" \" + docTitle;\r\n                    if (kr.leaveLogo) {\r\n                        $('[rel=\"icon\"]').attr(\"href\", OriginLogo);\r\n                    }\r\n                    titleTime = setTimeout(()=>{\r\n                        document.title = docTitle;\r\n                        titleTime = 0;\r\n                    }, 2000);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    const getTimeString = (msec, exact = true) => {\r\n        let tString;\r\n        const sec = msec / 1000;\r\n        const dnum = Math.floor(sec / 60 / 60 / 24);\r\n        const hnum = Math.floor(sec / 60 / 60 - (24 * dnum));\r\n        const mnum = Math.floor(sec / 60 - (24 * 60 * dnum) - (60 * hnum));\r\n        const snum = Math.floor(sec - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum));\r\n        let dstr = dnum.toString();\r\n        let hstr = hnum.toString();\r\n        let mstr = mnum.toString();\r\n        let sstr = snum.toString();\r\n        if (exact) {\r\n            if (dstr && dstr.length === 1) {\r\n                dstr = '0' + dstr;\r\n            }\r\n            if (hstr && hstr.length === 1) {\r\n                hstr = '0' + hstr;\r\n            }\r\n            if (mstr && mstr.length === 1) {\r\n                mstr = '0' + mstr;\r\n            }\r\n            if (sstr && sstr.length === 1) {\r\n                sstr = '0' + sstr;\r\n            }\r\n            tString = dstr + \"天\" + hstr + \"小时\" + mstr + \"分\" + sstr + \"秒\";\r\n        } else {\r\n            // 大概值\r\n            if (dnum < 540) {\r\n                // 一年半内\r\n                if (dnum < 60) {\r\n                    // 两个月内\r\n                    tString = dstr + \"天\";\r\n                } else {\r\n                    // 年内月外\r\n                    tString = Math.floor(dnum / 30).toString() + '个月';\r\n                }\r\n            } else {\r\n                // 年外\r\n                tString = Math.floor(dnum / 365).toString() + '年';\r\n            }\r\n        }\r\n        return tString;\r\n    };\r\n\r\n    const initTime = (kr) => {\r\n        const createTime = new Date(kr.createTime);\r\n        const upTimeNode = document.getElementById(\"span_dt\");\r\n        setInterval(() => {\r\n            upTimeNode.innerText = getTimeString(Date.now() - createTime);\r\n        }, 1000);\r\n    };\r\n\r\n    const codeCopyInit = () => {\r\n        const codeFigures = document.querySelectorAll('figure.highlight');\r\n        codeFigures.forEach((figure, count) => {\r\n            figure\r\n                .getElementsByTagName('table')[0]\r\n                .getElementsByTagName('tbody')[0]\r\n                .getElementsByTagName('tr')[0]\r\n                .getElementsByClassName('code')[0]\r\n            .setAttribute('id', `code-${count}`);\r\n\r\n            figure.innerHTML += \r\n            `<button class=\"copy\" onclick=\"copyCode(this, 'code-${count}')\">\r\n                <i class=\"fa fa-copy\"></i>&nbsp;复制\r\n            </button>`;\r\n        });\r\n    };\r\n\r\n    const commentsLazyLoad = () => {\r\n        // 检查当前是否在浏览器中运行\r\n        const runningOnBrowser = typeof window !== \"undefined\";\r\n        // 通过检查 scroll 事件 API 和 User-Agent 来匹配爬虫\r\n        const isBot = runningOnBrowser && !(\"onscroll\" in window) || typeof navigator !== \"undefined\" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);\r\n        // 检查当前浏览器是否支持 IntersectionObserver API\r\n        const supportsIntersectionObserver = runningOnBrowser && \"IntersectionObserver\" in window;\r\n        // 需要懒加载的评论区块\r\n        const commsArea = document.querySelector('.post-comments.lazy-load');\r\n        // 加载评论的函数\r\n        const loadwork = () => {\r\n            if (window.loadCommentsEventHandler) {\r\n                // 取消上一个加载事件\r\n                window.cancelIdleCallback(window.loadCommentsEventHandler);\r\n            }\r\n            if (typeof load_comm === 'undefined' || load_comm === null) {\r\n                return;\r\n            }\r\n            // 加载新评论模块\r\n            window.loadCommentsEventHandler = window.requestIdleCallback(load_comm);\r\n            // 防止二次加载，清理掉函数\r\n            load_comm = null;\r\n        };\r\n        if (runningOnBrowser && !isBot && supportsIntersectionObserver && commsArea !== null) {\r\n            const observer = new IntersectionObserver((entries) => {\r\n                if (entries[0].isIntersecting) {\r\n                    loadwork();\r\n                    observer.disconnect();\r\n                }\r\n            }, { threshold: 0 });\r\n            observer.observe(commsArea);\r\n        } else {\r\n            loadwork();\r\n        }\r\n    };\r\n\r\n    const expireNotify = (kr) => {\r\n        if (kr.expire_day) {\r\n            const expireAlert = document.getElementById('expire-alert');\r\n            if (expireAlert) {\r\n                const dateTimeTag = expireAlert.querySelector('time');\r\n                const updateDateTime = new Date(parseInt(dateTimeTag.getAttribute('datetime')));\r\n                const nowDateTime = Date.now();\r\n                const gap = nowDateTime - updateDateTime;\r\n                if (gap > kr.expire_day * 24 * 3600 * 1000) {\r\n                    // 内容可能过期，需要提示\r\n                    dateTimeTag.innerText = getTimeString(gap, false);\r\n                    expireAlert.classList.remove('hidden');\r\n                }\r\n            }\r\n            \r\n        }\r\n    };\r\n\r\n    const makeDelay = (callback, ms) => {\r\n        var timer = 0;\r\n        return function () {\r\n            var context = this, args = arguments;\r\n            clearTimeout(timer);\r\n            timer = setTimeout(function () {\r\n                callback.apply(context, args);\r\n            }, ms || 0);\r\n        };\r\n    }\r\n\r\n    const tocWidgetAnimInit = () => {\r\n        const sidebarTocWidget = document.getElementById('krw-toc');\r\n        const initFunc = () => {\r\n            // 有toc的页面\r\n            // 获取侧边栏所有的toc项\r\n            const tocDOMs = sidebarTocWidget.getElementsByClassName('toc-item');\r\n            // 元素高度映射记录\r\n            const tocItems = [];\r\n            try {\r\n                Array.from(tocDOMs).forEach((tocItem) => {\r\n                    const linkItem = tocItem.querySelector('.toc-link');\r\n                    const titleText = decodeURI(linkItem.getAttribute('href'));\r\n                    if (titleText.substring(0, 1) != '#') {\r\n                        throw new Error('TOC 小标题链接无效，格式无限');\r\n                    }\r\n                    const titleElem = document.getElementById(titleText.substring(1));\r\n                    if (!titleElem) {\r\n                        throw new Error('TOC 小标题链接无效，未找到相关引用');\r\n                    }\r\n                    titleElem.setAttribute(\"data-toc-id\", tocItems.length)\r\n                    tocItems.push({\r\n                        at: titleElem,\r\n                        el: tocItem\r\n                    });\r\n                });\r\n            } catch (e) {\r\n                console.log('错误：', e.message);\r\n                Array.from(tocDOMs).forEach((tocItem) => {\r\n                    tocItem.classList.add('show');\r\n                });\r\n                return;\r\n            }\r\n\r\n            // 初始化为不存在的标题\r\n            let curTocId = -1;\r\n            // 标题激活状态修改函数\r\n            const tocActivate = (newId) => {\r\n                if (curTocId === newId) {\r\n                    // Do nothing...\r\n                    return;\r\n                }\r\n                if (curTocId !== -1) {\r\n                    // 清除旧标题激活状态\r\n                    tocItems[curTocId].el.classList.remove('active');\r\n                    tocItems[curTocId].el.classList.remove('show');\r\n                    // 清除旧元素层级展示状态\r\n                    let nCur = tocItems[curTocId].el\r\n                    while (!nCur.classList.contains('toc')) {\r\n                        if (nCur.classList.contains('toc-item')) {\r\n                            nCur.classList.remove('show');\r\n                        }\r\n                        nCur = nCur.parentNode;\r\n                    }\r\n                }\r\n                if (newId !== -1) {\r\n                    // 构建新标题激活状态\r\n                    tocItems[newId].el.classList.add('active');\r\n                    tocItems[newId].el.classList.add('show');\r\n                    // 建立新元素层级展示状态\r\n                    let nCur = tocItems[newId].el\r\n                    while (!nCur.classList.contains('toc')) {\r\n                        if (nCur.classList.contains('toc-item')) {\r\n                            nCur.classList.add('show');\r\n                        }\r\n                        nCur = nCur.parentNode;\r\n                    }\r\n                }\r\n                curTocId = newId;\r\n            };\r\n\r\n            if (\"IntersectionObserver\" in window) {\r\n                const applyDecision = makeDelay((i, pos) => {\r\n                    if (pos === window.scrollY) {\r\n                        window.requestAnimationFrame(() => {\r\n                            tocActivate(i);\r\n                        });\r\n                    } else {\r\n                        applyDecision(i, window.scrollY);\r\n                    }\r\n                }, 100)\r\n\r\n                const observer = new IntersectionObserver((entries) => {\r\n                    let decision = null\r\n                    entries.forEach((entry) => {\r\n                        const currentIndex = Number.parseInt(entry.target.getAttribute('data-toc-id'), 10);\r\n                        if (!entry.isIntersecting\r\n                            && entry.boundingClientRect.top <= entry.rootBounds.top) {\r\n                            decision = currentIndex\r\n                        } else if (entry.isIntersecting\r\n                            && entry.boundingClientRect.bottom < entry.rootBounds.top + entry.rootBounds.height / 2\r\n                            && entry.intersectionRatio === 1) {\r\n                            decision = currentIndex - 1\r\n                        }\r\n                    })\r\n                    if (decision !== null) {\r\n                        applyDecision(decision, window.scrollY);\r\n                    }\r\n                }, {\r\n                    rootMargin: '-62px 0px 0px 0px',\r\n                    threshold: 1.0,\r\n                })\r\n                tocItems.forEach((x) => {\r\n                    observer.observe(x.at)\r\n                });\r\n                window.addEventListener('pjax:before', () => {\r\n                    observer.disconnect();\r\n                    tocItems.length = 0; // 奇妙的数组清空方式\r\n                }, { once: true });\r\n            } else {\r\n                const tocUpdatePos = () => {\r\n                    tocItems.forEach((x) => {\r\n                        x.h = x.at.getBoundingClientRect().top + window.scrollY - 61 // 比 click 事件那里多减掉1，避免浏览器 round 后导致的判断失败\r\n                    });\r\n                };\r\n\r\n                tocUpdatePos();\r\n\r\n                // 标题定位函数\r\n                const tocGetId = () => {\r\n                    let newPos;\r\n                    if (!Number.isInteger(curTocId) || curTocId < 0 || curTocId > tocItems.length - 1) {\r\n                        newPos = 0;\r\n                    } else {\r\n                        newPos = curTocId;\r\n                    }\r\n                    const nowY = window.scrollY;\r\n                    if (nowY >= tocItems[newPos].h) {\r\n                        if (nowY >= tocItems[tocItems.length - 1].h) {\r\n                            newPos = tocItems.length - 1;\r\n                        } else {\r\n                            while (nowY >= tocItems[newPos + 1].h) {\r\n                                newPos++;\r\n                            }\r\n                        }\r\n                    } else {\r\n                        while (nowY < tocItems[newPos].h) {\r\n                            newPos--;\r\n                            if (newPos < 0) break;\r\n                        }\r\n                    }\r\n                    return newPos;\r\n                }\r\n\r\n                // 处理事件的函数\r\n                const tocOnScroll = makeDelay(() => {\r\n                    window.requestAnimationFrame(() => {\r\n                        tocActivate(tocGetId());\r\n                    });\r\n                }, 100);\r\n\r\n                const tocOnResize = makeDelay(() => {\r\n                    tocUpdatePos();\r\n                    window.requestAnimationFrame(() => {\r\n                        tocActivate(tocGetId());\r\n                    });\r\n                }, 100);\r\n\r\n                window.addEventListener(\"resize\", tocOnResize);\r\n                window.addEventListener('scroll', tocOnScroll);\r\n                // pjax前销毁\r\n                window.addEventListener('pjax:before', () => {\r\n                    window.removeEventListener('resize', tocOnResize);\r\n                    window.removeEventListener('scroll', tocOnScroll);\r\n                    tocItems.length = 0; // 奇妙的数组清空方式\r\n                }, { once: true });\r\n            }\r\n\r\n            // 阅读进度\r\n            const readProgBar = document.getElementsByClassName('toc-progress-bar')[0];\r\n            const articleElem = document.querySelector('.kratos-post-content');\r\n            const setPercent = () => {\r\n                // 参考 Butterfly 主题相关实现\r\n                // https://github.com/jerryc127/hexo-theme-butterfly/blob/c1ac4a5e167f7bb26287fc9ca32a182cfc293231/source/js/main.js#L337-L346\r\n                if (articleElem) {\r\n                    const currentTop = window.scrollY || document.documentElement.scrollTop\r\n                    const docHeight = articleElem.clientHeight\r\n                    const winHeight = document.documentElement.clientHeight\r\n                    const headerHeight = articleElem.offsetTop\r\n                    const contentMath =\r\n                        (docHeight > winHeight) ?\r\n                            (docHeight - winHeight) :\r\n                            (document.documentElement.scrollHeight - winHeight)\r\n                    const scrollPercent = Math.max(0, Math.min((currentTop - headerHeight) / (contentMath), 1))\r\n                    const scrollPercentRound = Math.round(scrollPercent * 100)\r\n                    readProgBar.style.width = (scrollPercent * 100).toString() + '%';\r\n                    readProgBar.setAttribute('aria-valuenow', scrollPercentRound);\r\n                }\r\n            }\r\n            window.addEventListener('scroll', () => {\r\n                window.requestAnimationFrame(setPercent);\r\n            });\r\n            setPercent(); // 初始运行一次\r\n        }\r\n        if (sidebarTocWidget) {\r\n            if (sidebarTocWidget.offsetParent !== null) {\r\n                initFunc();\r\n            } else if (\"IntersectionObserver\" in window) {\r\n                // Init when become visible\r\n                new IntersectionObserver(initFunc, {\r\n                    threshold: 0,\r\n                    once: true,\r\n                }).observe(sidebarTocWidget);\r\n            }\r\n        }\r\n    };\r\n\r\n    const topNavScrollToggleInit = (kr) => {\r\n        // 判断设置参数\r\n        if (!kr.topNavScrollToggle) {\r\n            return; // 没有启用\r\n        }\r\n        // 记录上一次滚动高度，用于判断滚动方向\r\n        let lastHeight = window.innerHeight;\r\n        // 记录顶部栏隐藏状态\r\n        let isTopNavHidden = false;\r\n\r\n        // 处理事件的函数\r\n        const handleTopNavScrollToggle = () => {\r\n            window.requestAnimationFrame(() => {\r\n                if (lastHeight < window.scrollY) {\r\n                    // 向下滚动\r\n                    if (!isTopNavHidden) {\r\n                        document.body.classList.add('nav-up');\r\n                        isTopNavHidden = true;\r\n                    }\r\n                } else if (lastHeight > window.scrollY) {\r\n                    // 向上滚动\r\n                    if (isTopNavHidden) {\r\n                        document.body.classList.remove('nav-up');\r\n                        isTopNavHidden = false;\r\n                    }\r\n                }\r\n                // 相等则不做处理\r\n                lastHeight = window.scrollY;\r\n            });\r\n        };\r\n\r\n        // 仅处理鼠标滚动\r\n        window.addEventListener('wheel', handleTopNavScrollToggle);\r\n\r\n    };\r\n\r\n    const initPerPage = () => {\r\n        tocWidgetAnimInit();\r\n        saveTitle();\r\n        codeCopyInit();\r\n        fancyboxInit();\r\n        commentsLazyLoad();\r\n    };\r\n\r\n    const initPerPageWithConfig = kr => {\r\n        loadRandomCover(kr);\r\n        setCopyright(kr);\r\n        expireNotify(kr);\r\n    };\r\n\r\n    window.addEventListener('pjax:complete', () => {\r\n        initPerPage();\r\n        if (typeof MathJax !== 'undefined') {\r\n            MathJax.Hub.Typeset();\r\n        }\r\n    });\r\n\r\n    function themeInit() {\r\n        document.removeEventListener(\"DOMContentLoaded\", themeInit, false);\r\n        window.removeEventListener(\"load\", themeInit, false);\r\n\r\n        loadConfig().then(kr => {\r\n            copyEventInit(kr);\r\n            leaveEventInit(kr);\r\n            initTime(kr);\r\n            donateConfig(kr);\r\n            topNavScrollToggleInit(kr);\r\n            initPerPageWithConfig(kr);\r\n            window.addEventListener('pjax:complete', () => {\r\n                initPerPageWithConfig(kr);\r\n            });\r\n        });\r\n        \r\n        pageScrollDownInit();\r\n        offcanvas();\r\n        mobiClick();\r\n        xControl();\r\n        shareMenu();\r\n        tocNavInit();\r\n        initPerPage();\r\n    }\r\n\r\n    if (document.readyState === \"complete\") {\r\n        setTimeout(themeInit);\r\n    } else {\r\n        document.addEventListener(\"DOMContentLoaded\", themeInit, false);\r\n        window.addEventListener(\"load\", themeInit, false); //fallback\r\n    }\r\n})();\r\n"]}